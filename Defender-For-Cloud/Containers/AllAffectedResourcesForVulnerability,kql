securityresources 
                | where type =~ "microsoft.security/assessments/subassessments"
                | extend assessmentKey=extract(@"(?i)providers/Microsoft.Security/assessments/([^/]*)", 1, id)
                | where assessmentKey == "c0b7cfc6-3172-465a-b378-53c7ff2cc0d5"
                | where properties.status.code == "Unhealthy"
                | extend parentResourceId = extract(@"(?i)(.*/Microsoft.ContainerRegistry/registries/[^/]*)", 1, id)
                | extend resourceId = tostring(properties.resourceDetails.id)
                | extend publishedDate = tostring(properties.additionalData.vulnerabilityDetails.publishedDate)
                | extend repositoryName = tostring(properties.additionalData.artifactDetails.repositoryName)
                | extend registryHost = tostring(properties.additionalData.artifactDetails.registryHost)
                | extend artifactType = tostring(properties.additionalData.artifactDetails.artifactType)
                | extend imageDigest = tostring(properties.additionalData.artifactDetails.digest)
                | extend cveId = tostring(properties.additionalData.vulnerabilityDetails.cveId),
                        cveScore = tostring(properties.additionalData.cvssV30Score),
                        subAssessmentDescription=tostring(properties.description),
                        subAssessmentRemediation=tostring(properties.remediation),
                        subAssessmentCategory=tostring(properties.additionalData.softwareDetails.category),
                        severity = tostring(properties.additionalData.vulnerabilityDetails.severity),
                        status=tostring(properties.status.code),
                        additionalData=tostring(properties.additionalData)
                | where severity == "Critical" // filter by Severity
                //| project resourceGroup, registryHost, repositoryName, artifactType, imageDigest, cveId, cveScore, severity, publishedDate, subAssessmentCategory, subAssessmentDescription, subAssessmentRemediation
                | order by cveScore desc // sort by Cve Score
                //| extend critical = iff(severity == "Critical", 5,0), 
                //        high = iff(severity == "High", 4,0), 
                //        medium = iff(severity == "Medium", 3, 0), 
                //        low = iff(severity == "Low", 2 ,0),
                //        unknown = iff(severity == "Unknown", 1, 0)
                //| extend all = critical + high + medium + low + unknown
                //| order by all desc
